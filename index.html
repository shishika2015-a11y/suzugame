<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…¨å›½é€£æ‰“ã‚¹ãƒ”ãƒ¼ãƒ‰é¸æ‰‹æ¨©</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  text-align:center;
  background:linear-gradient(#eef,#cde);
}
h1{margin-top:10px}

#panel{
  background:#fff;
  width:95%;
  max-width:360px;
  margin:20px auto;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}

button{
  padding:12px 20px;
  margin:6px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.easy{background:#8bc34a}
.normal{background:#03a9f4;color:#fff}

#tap{
  margin:20px auto;
  width:100%;
  max-width:260px;
  height:120px;
  line-height:120px;
  font-size:28px;
  background:#ddd;
  border-radius:14px;
  user-select:none;
  touch-action:manipulation;
}

.running{
  background:#ff5722;
  color:#fff;
}

#countdown{
  font-size:48px;
  color:#ff9800;
  height:60px;
}

.rank{margin:6px 0}
</style>
</head>

<body>
<h1>ğŸ”¥ å…¨å›½é€£æ‰“ã‚¹ãƒ”ãƒ¼ãƒ‰é¸æ‰‹æ¨© ğŸ”¥</h1>
<p>ç¾åœ¨ <b id="population"></b> äººãŒå‚åŠ ä¸­</p>

<div id="panel">
  <input id="player" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å" maxlength="10"><br><br>

  <button class="easy" onclick="setMode(5)">5ç§’</button>
  <button class="normal" onclick="setMode(15)">15ç§’</button>
  <p>åˆ¶é™æ™‚é–“ï¼š<span id="modeText">15ç§’</span></p>

  <button onclick="start()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <div id="countdown"></div>

  <div id="tap">ã‚¿ãƒƒãƒ—ï¼</div>

  <p>æ®‹ã‚Šæ™‚é–“ï¼š<span id="time">0</span> ç§’</p>
  <p>ã‚¿ãƒƒãƒ—æ•°ï¼š<span id="count">0</span></p>

  <p id="result"></p>
  <p id="nationRank"></p>

  <h3>ğŸ† é›£æ˜“åº¦åˆ¥TOP5</h3>
  <div id="ranking"></div>
</div>

<script>
/* åˆæœŸå€¤ */
let limit=15, time=0, count=0, playing=false, timer;
const pop=Math.floor(Math.random()*90000)+10000;
population.textContent=pop.toLocaleString();

/* è¦ç´  */
const tap=document.getElementById("tap");
const timeEl=document.getElementById("time");
const countEl=document.getElementById("count");
const result=document.getElementById("result");
const nationRank=document.getElementById("nationRank");
const rankingEl=document.getElementById("ranking");
const countdownEl=document.getElementById("countdown");

/* é›£æ˜“åº¦è¨­å®š */
function setMode(sec){
  limit=sec;
  document.getElementById("modeText").textContent=sec+"ç§’";
  showRank();
}

/* ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼‰ */
function start(){
  if(playing) return;
  let c=3;
  countdownEl.textContent=c;

  const cd=setInterval(()=>{
    c--;
    if(c>0){
      countdownEl.textContent=c;
    }else{
      clearInterval(cd);
      countdownEl.textContent="GO!";
      setTimeout(()=>{
        countdownEl.textContent="";
        begin();
      },400);
    }
  },700);
}

function begin(){
  time=limit;
  count=0;
  playing=true;
  timeEl.textContent=time;
  countEl.textContent=0;
  result.textContent="";
  nationRank.textContent="";
  tap.classList.add("running");

  timer=setInterval(()=>{
    time--;
    timeEl.textContent=time;
    if(time<=0) end();
  },1000);
}

/* ã‚¿ãƒƒãƒ—ï¼ˆã‚¹ãƒãƒ›ï¼‹PCï¼‰ */
function tapAction(){
  if(!playing) return;
  count++;
  countEl.textContent=count;
}

tap.addEventListener("touchstart", e=>{
  e.preventDefault();
  tapAction();
});

tap.addEventListener("click", tapAction);

/* çµ‚äº† */
function end(){
  clearInterval(timer);
  playing=false;
  tap.classList.remove("running");

  const cps=(count/limit).toFixed(2);
  result.textContent=`çµæœï¼š${count} å›ï¼ˆ${cps}/ç§’ï¼‰`;

  const rank=Math.floor(Math.random()*(pop-1))+1;
  nationRank.textContent=`ğŸŒ ã‚ãªãŸã¯å…¨å›½ ${rank.toLocaleString()} ä½ï¼`;

  saveRank(cps);
  showRank();
}

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜ */
function saveRank(score){
  const key="rank_"+limit;
  const name=document.getElementById("player").value || "NO NAME";
  const list=JSON.parse(localStorage.getItem(key) || "[]");
  list.push({name,score});
  list.sort((a,b)=>b.score-a.score);
  localStorage.setItem(key, JSON.stringify(list.slice(0,5)));
}

/* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º */
function showRank(){
  const key="rank_"+limit;
  const list=JSON.parse(localStorage.getItem(key) || "[]");
  rankingEl.innerHTML="";
  list.forEach((r,i)=>{
    rankingEl.innerHTML+=
      `<div class="rank">${i+1}. ${r.name} - ${r.score}/ç§’</div>`;
  });
}

showRank();
</script>
</body>
</html>

